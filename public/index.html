<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Øª - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„ØªÙˆØµÙŠÙ„</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2E7D32;
            --primary-dark: #1B5E20;
            --primary-light: #4CAF50;
            --secondary: #FF9800;
            --text: #333;
            --text-light: #666;
            --background: #F5F5F5;
            --white: #FFFFFF;
            --border: #E0E0E0;
            --success: #4CAF50;
            --error: #F44336;
            --warning: #FF9800;
            --info: #2196F3;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Tahoma', 'Geneva', 'Verdana', sans-serif;
        }

        body {
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 1rem;
        }

        .nav-menu a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background 0.3s;
            cursor: pointer;
        }

        .nav-menu a:hover,
        .nav-menu a.active {
            background: rgba(255,255,255,0.1);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Main Content */
        .main-content {
            margin-top: 80px;
            padding: 2rem 0;
            min-height: calc(100vh - 120px);
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
            animation: fadeIn 0.5s ease;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary-light);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .product-card {
            background: var(--white);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border: 1px solid var(--border);
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .product-image {
            height: 200px;
            background: var(--border);
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary);
            margin: 0.5rem 0;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #F57C00;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }

        /* Modal */
        .modal {
            display: none; /* ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ù…Ù† flex Ø¥Ù„Ù‰ none */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex !important; /* ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø¶Ø§ÙØ© !important */
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            left: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            z-index: 1;
        }

        .modal-close:hover {
            color: var(--error);
        }

        /* Sections */
        .page-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page-section.active {
            display: block;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid rgba(46, 125, 50, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin: 2rem auto;
            display: block;
        }

        /* Messages */
        .message {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            animation: slideDown 0.3s ease;
        }

        .message.success {
            background: #E8F5E9;
            color: var(--primary);
            border: 1px solid #C8E6C9;
        }

        .message.error {
            background: #FFEBEE;
            color: var(--error);
            border: 1px solid #FFCDD2;
        }

        .message.info {
            background: #E3F2FD;
            color: var(--info);
            border: 1px solid #BBDEFB;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Wallet Card */
        .wallet-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .balance-amount {
            font-size: 3rem;
            font-weight: bold;
            margin: 1rem 0;
        }

        /* Market Card */
        .market-card {
            background: var(--white);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary);
            transition: transform 0.3s;
        }

        .market-card:hover {
            transform: translateX(-5px);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Input focus styles */
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }

        /* Link styles */
        a {
            color: var(--primary);
            text-decoration: none;
            transition: color 0.3s;
        }

        a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo" onclick="showSection('home')">
                    <i class="fas fa-leaf"></i>
                    <span>ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Øª</span>
                </div>
                
                <ul class="nav-menu">
                    <li><a href="#" onclick="showSection('home'); return false;" class="active" data-section="home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                    <li><a href="#" onclick="showSection('products'); return false;" data-section="products">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a></li>
                    <li><a href="#" onclick="showSection('markets'); return false;" data-section="markets">Ø§Ù„Ø£Ø³ÙˆØ§Ù‚</a></li>
                    <li><a href="#" onclick="showSection('wallet'); return false;" data-section="wallet">Ø§Ù„Ù…Ø­ÙØ¸Ø©</a></li>
                    <li><a href="#" onclick="showSection('orders'); return false;" data-section="orders">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a></li>
                </ul>
                
                <div class="user-menu" id="userMenu">
                    <button class="btn btn-outline" id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Messages Container -->
            <div id="messagesContainer"></div>

            <!-- Home Section -->
            <section id="homeSection" class="page-section active">
                <div class="card">
                    <div class="card-header">
                        <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Øª</h2>
                        <div id="userGreeting"></div>
                    </div>
                    
                    <p>Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¨ÙŠØ¹ ÙˆØªÙˆØµÙŠÙ„ Ø§Ù„Ù‚Ø§Øª Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†</p>
                    
                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card" onclick="showSection('products')">
                            <div class="stat-number" id="productsCount">0</div>
                            <div>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
                        </div>
                        
                        <div class="stat-card" onclick="showSection('markets')">
                            <div class="stat-number" id="marketsCount">0</div>
                            <div>Ø§Ù„Ø£Ø³ÙˆØ§Ù‚</div>
                        </div>
                        
                        <div class="stat-card" onclick="showSection('orders')">
                            <div class="stat-number" id="ordersCount">0</div>
                            <div>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                        </div>
                        
                        <div class="stat-card" onclick="showSection('wallet')">
                            <div class="stat-number" id="walletBalance">0</div>
                            <div>Ø§Ù„Ø±ØµÙŠØ¯ (Ø±ÙŠØ§Ù„)</div>
                        </div>
                    </div>
                </div>

                <!-- Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ -->
                <div class="card">
                    <div class="card-header">
                        <h3>Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„Ù…ØªØ§Ø­Ø©</h3>
                        <button class="btn btn-primary" onclick="showSection('markets')">
                            <i class="fas fa-store"></i> Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
                        </button>
                    </div>
                    <div id="marketsPreview" class="products-grid">
                        <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ù‡Ù†Ø§ -->
                    </div>
                </div>

                <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
                <div class="card">
                    <div class="card-header">
                        <h3>Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                        <button class="btn btn-primary" onclick="showSection('products')">
                            <i class="fas fa-shopping-basket"></i> Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
                        </button>
                    </div>
                    <div id="productsPreview" class="products-grid">
                        <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‡Ù†Ø§ -->
                    </div>
                </div>
            </section>

            <!-- Products Section -->
            <section id="productsSection" class="page-section">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-shopping-basket"></i> Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù‚Ø§Øª</h2>
                        <div>
                            <button class="btn btn-primary" onclick="loadProducts()">
                                <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                            </button>
                            <button class="btn btn-secondary" onclick="showAddProductModal()" style="margin-right: 10px;">
                                <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
                            </button>
                        </div>
                    </div>
                    
                    <!-- Search and Filter -->
                    <div style="margin-bottom: 1.5rem;">
                        <div class="form-group">
                            <input type="text" class="form-control" id="productSearch" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." onkeyup="searchProducts()">
                        </div>
                    </div>
                    
                    <div class="products-grid" id="productsGrid">
                        <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                    
                    <div id="productsLoading" class="loading" style="display: none;"></div>
                </div>
            </section>

            <!-- Markets Section -->
            <section id="marketsSection" class="page-section">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-store"></i> Ø§Ù„Ø£Ø³ÙˆØ§Ù‚</h2>
                        <button class="btn btn-primary" onclick="loadMarkets()">
                            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                        </button>
                    </div>
                    
                    <div id="marketsList">
                        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                    
                    <div id="marketsLoading" class="loading" style="display: none;"></div>
                </div>
            </section>

            <!-- Wallet Section -->
            <section id="walletSection" class="page-section">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-wallet"></i> Ù…Ø­ÙØ¸ØªÙƒ</h2>
                        <button class="btn btn-primary" onclick="loadWallet()">
                            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯
                        </button>
                    </div>
                    
                    <div class="wallet-card">
                        <div class="balance-amount" id="balanceAmount">0 Ø±ÙŠØ§Ù„</div>
                        <p>Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                        <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
                            <button class="btn btn-secondary" onclick="showDepositModal()">
                                <i class="fas fa-money-bill-wave"></i> Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯
                            </button>
                            <button class="btn btn-outline" style="background: rgba(255,255,255,0.2); color: white;" onclick="showWithdrawModal()">
                                <i class="fas fa-hand-holding-usd"></i> Ø³Ø­Ø¨ Ø£Ù…ÙˆØ§Ù„
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 style="margin-bottom: 1rem;">Ø¢Ø®Ø± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
                        <div id="transactionsList">
                            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="ordersSection" class="page-section">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-shopping-cart"></i> Ø·Ù„Ø¨Ø§ØªÙŠ</h2>
                        <button class="btn btn-primary" onclick="loadOrders()">
                            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                        </button>
                    </div>
                    
                    <div id="ordersList">
                        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                    
                    <div id="ordersLoading" class="loading" style="display: none;"></div>
                </div>
            </section>
        </div>
    </main>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('loginModal')">
                <i class="fas fa-times"></i>
            </button>
            <div style="padding: 2rem;">
                <h2 style="text-align: center; margin-bottom: 1.5rem; color: var(--primary);">
                    <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </h2>
                
                <form id="loginForm">
                    <div class="form-group">
                        <input type="email" class="form-control" id="loginEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
                    </div>
                    
                    <div class="form-group">
                        <input type="password" class="form-control" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                </form>
                
                <div style="text-align: center; margin-top: 1rem;">
                    <a href="#" id="registerLink" style="color: var(--primary); text-decoration: none;">
                        <i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('registerModal')">
                <i class="fas fa-times"></i>
            </button>
            <div style="padding: 2rem;">
                <h2 style="text-align: center; margin-bottom: 1.5rem; color: var(--primary);">
                    <i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                </h2>
                
                <form id="registerForm">
                    <div class="form-group">
                        <input type="text" class="form-control" id="regName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
                    </div>
                    
                    <div class="form-group">
                        <input type="email" class="form-control" id="regEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
                    </div>
                    
                    <div class="form-group">
                        <input type="tel" class="form-control" id="regPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
                    </div>
                    
                    <div class="form-group">
                        <select class="form-control" id="regRole" required>
                            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</option>
                            <option value="buyer">Ù…Ø´ØªØ±ÙŠ</option>
                            <option value="seller">Ø¨Ø§Ø¦Ø¹</option>
                            <option value="driver">Ù…Ù†Ø¯ÙˆØ¨ ØªÙˆØµÙŠÙ„</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="storeField" style="display: none;">
                        <input type="text" class="form-control" id="regStore" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±">
                    </div>
                    
                    <div class="form-group" id="vehicleField" style="display: none;">
                        <input type="text" class="form-control" id="regVehicle" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©">
                    </div>
                    
                    <div class="form-group">
                        <input type="password" class="form-control" id="regPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                    </div>
                    
                    <div class="form-group">
                        <input type="password" class="form-control" id="regConfirmPassword" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
                    </button>
                </form>
                
                <div style="text-align: center; margin-top: 1rem;">
                    <a href="#" id="loginLink" style="color: var(--primary); text-decoration: none;">
                        <i class="fas fa-sign-in-alt"></i> Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Deposit Modal -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('depositModal')">
                <i class="fas fa-times"></i>
            </button>
            <div style="padding: 2rem;">
                <h2 style="text-align: center; margin-bottom: 1.5rem; color: var(--primary);">
                    <i class="fas fa-money-bill-wave"></i> Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯
                </h2>
                
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº (Ø±ÙŠØ§Ù„)</label>
                    <input type="number" class="form-control" id="depositAmount" min="10" value="100" step="10">
                </div>
                
                <div class="form-group">
                    <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                    <select class="form-control" id="depositMethod">
                        <option value="jib">Ù…Ø­ÙØ¸Ø© Ø¬ÙŠØ¨</option>
                        <option value="jawaly">Ù…Ø­ÙØ¸Ø© Ø¬ÙˆØ§Ù„ÙŠ</option>
                        <option value="mobile">Ù…ÙˆØ¨Ø§ÙŠÙ„ Ù…ÙˆÙ†ÙŠ</option>
                        <option value="shamel">Ø§Ù„Ø´Ø§Ù…Ù„ Ù…ÙˆÙ†ÙŠ</option>
                        <option value="fulus">ÙÙ„ÙˆØ³Ùƒ</option>
                    </select>
                </div>
                
                <div style="background: #FFF3E0; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                    <p><strong><i class="fas fa-info-circle"></i> ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù†:</strong></p>
                    <p>1. Ø£Ø±Ø³Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¥Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…: <strong>771831482</strong></p>
                    <p>2. Ø§Ù„Ø§Ø³Ù…: <strong>ÙŠÙˆØ³Ù Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø­Ù…ÙˆØ¯ Ø²Ù‡ÙŠØ±</strong></p>
                    <p>3. Ø£Ø±Ø³Ù„ Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</p>
                </div>
                
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-primary" style="flex: 1;" onclick="processDeposit()">
                        <i class="fas fa-check"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø­Ù†
                    </button>
                    <button class="btn btn-outline" style="flex: 1;" onclick="closeModal('depositModal')">
                        <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ============
        const appState = {
            user: null,
            products: [],
            markets: [],
            wallet: null,
            orders: [],
            currentSection: 'home'
        };

        // ============ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ============
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            setupEventListeners();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
            checkAuth();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            loadInitialData();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ†Ù‚Ù„
            setupNavigation();
            
            console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
        });

        // ============ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ) ============
        function setupEventListeners() {
            console.log('ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«...');
            
            // Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ
            const loginBtn = document.getElementById('loginBtn');
            if (loginBtn) {
                loginBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    showModal('loginModal');
                });
                console.log('âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
            }
            
            // Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª
            const registerLink = document.getElementById('registerLink');
            if (registerLink) {
                registerLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    closeModal('loginModal');
                    setTimeout(() => showModal('registerModal'), 300);
                });
                console.log('âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ³Ø¬ÙŠÙ„');
            }
            
            const loginLink = document.getElementById('loginLink');
            if (loginLink) {
                loginLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    closeModal('registerModal');
                    setTimeout(() => showModal('loginModal'), 300);
                });
                console.log('âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø§Ø¨Ø· ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
            }
            
            // Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    login();
                });
                console.log('âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
            }
            
            // Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    register();
                });
                console.log('âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„');
            }
            
            // ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            const regRole = document.getElementById('regRole');
            if (regRole) {
                regRole.addEventListener('change', toggleRegisterFields);
                console.log('âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨');
            }
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
            window.addEventListener('click', function(event) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (event.target === modal) {
                        closeModal(modal.id);
                    }
                });
            });
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø¹Ù†Ø¯ Ø¶ØºØ· ESC
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    const activeModal = document.querySelector('.modal.show');
                    if (activeModal) {
                        closeModal(activeModal.id);
                    }
                }
            });
            
            console.log('âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«');
        }

        // ============ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ†Ù‚Ù„ ============
        function setupNavigation() {
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ù„Ù„Ø±ÙˆØ§Ø¨Ø·
            const navLinks = document.querySelectorAll('.nav-menu a');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    if (section) {
                        showSection(section);
                    }
                });
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ù„Ù„Ø´Ø¹Ø§Ø±
            const logo = document.querySelector('.logo');
            if (logo) {
                logo.addEventListener('click', function(e) {
                    e.preventDefault();
                    showSection('home');
                });
            }
        }

        // ============ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª (Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ) ============
        function showModal(modalId) {
            console.log(`ğŸ“‚ ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: ${modalId}`);
            const modal = document.getElementById(modalId);
            if (modal) {
                // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
                const allModals = document.querySelectorAll('.modal');
                allModals.forEach(m => m.classList.remove('show'));
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                modal.classList.add('show');
                document.body.style.overflow = 'hidden'; // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
                
                // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„
                setTimeout(() => {
                    const firstInput = modal.querySelector('input, select, textarea');
                    if (firstInput) firstInput.focus();
                }, 100);
                
                console.log(`âœ… ØªÙ… ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: ${modalId}`);
            } else {
                console.error(`âŒ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯: ${modalId}`);
            }
        }

        function closeModal(modalId) {
            console.log(`ğŸ“‚ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: ${modalId}`);
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = ''; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ±
                console.log(`âœ… ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: ${modalId}`);
            }
        }

        // ============ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ============
        async function checkAuth() {
            try {
                console.log('ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©...');
                const response = await fetch('/api/auth/check', {
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (data.isAuthenticated && data.user) {
                    appState.user = data.user;
                    console.log('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', appState.user.email);
                    updateUI();
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    if (appState.user) {
                        loadWallet();
                        loadOrders();
                    }
                } else {
                    console.log('âŒ Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©:', error);
            }
        }

        // ============ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ============
        async function loadInitialData() {
            try {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                await loadProducts();
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚
                await loadMarkets();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                updateStats();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©:', error);
            }
        }

        // ============ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ============
        function showSection(sectionId) {
            console.log('ğŸ“ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø³Ù…:', sectionId);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            appState.currentSection = sectionId;
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            const sections = document.querySelectorAll('.page-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            const targetSection = document.getElementById(sectionId + 'Section');
            if (targetSection) {
                targetSection.classList.add('active');
                console.log('âœ… ØªÙ… Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù…:', sectionId);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù†Ø´Ø·
                updateActiveNav(sectionId);
                
                // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø³Ù… Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
                loadSectionData(sectionId);
                
                // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                console.error('âŒ Ø§Ù„Ù‚Ø³Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯:', sectionId);
                showMessage('error', 'Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            }
        }

        // ============ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù†Ø´Ø· ============
        function updateActiveNav(activeSection) {
            const navLinks = document.querySelectorAll('.nav-menu a');
            navLinks.forEach(link => {
                const section = link.getAttribute('data-section');
                if (section === activeSection) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        }

        // ============ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø³Ù… ============
        function loadSectionData(sectionId) {
            switch(sectionId) {
                case 'products':
                    if (appState.products.length === 0) {
                        loadProducts();
                    }
                    break;
                case 'markets':
                    if (appState.markets.length === 0) {
                        loadMarkets();
                    }
                    break;
                case 'wallet':
                    if (appState.user && !appState.wallet) {
                        loadWallet();
                    }
                    break;
                case 'orders':
                    if (appState.user && appState.orders.length === 0) {
                        loadOrders();
                    }
                    break;
                case 'home':
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø§Ù†ÙˆØ±Ø§Ù…Ø§
                    updateHomePreview();
                    break;
            }
        }

        // ============ ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ============
        function updateUI() {
            const userMenu = document.getElementById('userMenu');
            const userGreeting = document.getElementById('userGreeting');
            
            if (appState.user) {
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                userMenu.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="background: var(--primary); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2rem;">
                            ${appState.user.name.charAt(0)}
                        </div>
                        <span style="font-weight: 500;">${appState.user.name}</span>
                        <button class="btn btn-outline" onclick="logout()" style="margin-right: 10px;">
                            <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                        </button>
                    </div>
                `;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±Ø­ÙŠØ¨
                if (userGreeting) {
                    userGreeting.innerHTML = `
                        <h3 style="color: var(--primary); margin: 0;">
                            <i class="fas fa-user-circle"></i> Ù…Ø±Ø­Ø¨Ø§Ù‹ ${appState.user.name}
                        </h3>
                        <p style="color: var(--text-light); margin: 0.5rem 0 0 0;">
                            Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨: ${appState.user.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 
                                        appState.user.role === 'seller' ? 'Ø¨Ø§Ø¦Ø¹' : 
                                        appState.user.role === 'buyer' ? 'Ù…Ø´ØªØ±ÙŠ' : 'Ù…Ù†Ø¯ÙˆØ¨ ØªÙˆØµÙŠÙ„'}
                        </p>
                    `;
                }
                
            } else {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                userMenu.innerHTML = `
                    <button class="btn btn-outline" id="loginBtn">
                        <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                `;
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø²Ø±
                const newLoginBtn = document.getElementById('loginBtn');
                if (newLoginBtn) {
                    newLoginBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        showModal('loginModal');
                    });
                }
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ±Ø­ÙŠØ¨
                if (userGreeting) {
                    userGreeting.innerHTML = `
                        <h3 style="color: var(--text-light);">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Øª</h3>
                        <p style="color: var(--text-light);">Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¨Ø¯Ø¡</p>
                    `;
                }
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateStats();
        }

        // ============ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ============
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showMessage('error', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }
            
            try {
                showLoadingMessage('loginForm', 'Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...');
                
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password }),
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                hideLoadingMessage('loginForm');
                
                if (response.ok) {
                    appState.user = data.user;
                    updateUI();
                    closeModal('loginModal');
                    showMessage('success', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    loadWallet();
                    loadOrders();
                    loadProducts();
                    loadMarkets();
                    
                } else {
                    showMessage('error', data.error || 'Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                }
            } catch (error) {
                hideLoadingMessage('loginForm');
                showMessage('error', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
            }
        }

        // ============ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ============
        async function register() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const phone = document.getElementById('regPhone').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            const role = document.getElementById('regRole').value;
            const storeName = document.getElementById('regStore').value;
            const vehicleType = document.getElementById('regVehicle').value;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!name || !email || !phone || !password || !confirmPassword || !role) {
                showMessage('error', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('error', 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
                return;
            }
            
            if (role === 'seller' && !storeName) {
                showMessage('error', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±');
                return;
            }
            
            if (role === 'driver' && !vehicleType) {
                showMessage('error', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©');
                return;
            }
            
            try {
                showLoadingMessage('registerForm', 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...');
                
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name,
                        email,
                        phone,
                        password,
                        role,
                        storeName: role === 'seller' ? storeName : '',
                        vehicleType: role === 'driver' ? vehicleType : ''
                    })
                });
                
                const data = await response.json();
                
                hideLoadingMessage('registerForm');
                
                if (response.ok) {
                    showMessage('success', 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
                    closeModal('registerModal');
                    showModal('loginModal');
                } else {
                    showMessage('error', data.error || 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨');
                }
            } catch (error) {
                hideLoadingMessage('registerForm');
                showMessage('error', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', error);
            }
        }

        // ============ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ============
        async function logout() {
            try {
                const response = await fetch('/api/logout', {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    appState.user = null;
                    appState.wallet = null;
                    appState.orders = [];
                    updateUI();
                    showMessage('success', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­');
                    showSection('home');
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:', error);
                showMessage('error', 'Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
            }
        }

        // ============ ØªØ¨Ø¯ÙŠÙ„ Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ============
        function toggleRegisterFields() {
            const role = document.getElementById('regRole').value;
            document.getElementById('storeField').style.display = role === 'seller' ? 'block' : 'none';
            document.getElementById('vehicleField').style.display = role === 'driver' ? 'block' : 'none';
        }

        // ============ Ø¯ÙˆØ§Ù„ Ø£Ø®Ø±Ù‰ (Ù…Ø®ØªØµØ±Ø© Ù„Ù„Ø§Ø®ØªØµØ§Ø±) ============
        // [Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ Ù…Ù† Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚]
        // Ù…Ø«Ù„: loadProducts, renderProducts, loadMarkets, renderMarkets, loadWallet, etc.
        
        // Ù„Ù„Ø§Ø®ØªØµØ§Ø±ØŒ Ø³Ø£Ø¶Ø¹ ÙÙ‚Ø· Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©
        async function loadProducts() {
            try {
                const response = await fetch('/api/products');
                const data = await response.json();
                if (data.success) {
                    appState.products = data.products;
                    renderProducts();
                    updateStats();
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', error);
            }
        }

        async function loadMarkets() {
            try {
                const response = await fetch('/api/markets');
                const data = await response.json();
                if (data.success) {
                    appState.markets = data.markets;
                    renderMarkets();
                    updateStats();
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚:', error);
            }
        }

        async function loadWallet() {
            if (!appState.user) return;
            try {
                const response = await fetch('/api/wallet', { credentials: 'include' });
                const data = await response.json();
                if (data.success) {
                    appState.wallet = data.wallet;
                    updateWalletDisplay();
                    updateStats();
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ÙØ¸Ø©:', error);
            }
        }

        function updateWalletDisplay() {
            const balanceAmount = document.getElementById('balanceAmount');
            if (balanceAmount && appState.wallet) {
                balanceAmount.textContent = `${appState.wallet.balance} Ø±ÙŠØ§Ù„`;
            }
        }

        function updateStats() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const productsCount = document.getElementById('productsCount');
            const marketsCount = document.getElementById('marketsCount');
            const ordersCount = document.getElementById('ordersCount');
            const walletBalance = document.getElementById('walletBalance');
            
            if (productsCount) productsCount.textContent = appState.products.length;
            if (marketsCount) marketsCount.textContent = appState.markets.length;
            if (ordersCount) ordersCount.textContent = appState.orders.length;
            if (walletBalance) {
                walletBalance.textContent = appState.wallet ? appState.wallet.balance : '0';
            }
        }

        function showMessage(type, text) {
            const messagesContainer = document.getElementById('messagesContainer');
            if (!messagesContainer) return;
            
            const messageId = 'msg-' + Date.now();
            const messageHtml = `
                <div class="message ${type}" id="${messageId}">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                     type === 'error' ? 'exclamation-circle' : 
                                     'info-circle'}"></i>
                    <span>${text}</span>
                    <button onclick="document.getElementById('${messageId}').remove()" 
                            style="margin-right: auto; background: none; border: none; color: inherit; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            messagesContainer.insertAdjacentHTML('afterbegin', messageHtml);
            
            setTimeout(() => {
                const msg = document.getElementById(messageId);
                if (msg) msg.remove();
            }, 5000);
        }

        function showLoadingMessage(elementId, text = '') {
            const element = document.getElementById(elementId);
            if (element) {
                const submitBtn = element.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${text}`;
                    submitBtn.disabled = true;
                }
            }
        }

        function hideLoadingMessage(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                const submitBtn = element.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.innerHTML = submitBtn.innerHTML.replace(/<i class="fas fa-spinner fa-spin"><\/i> /, '');
                    submitBtn.disabled = false;
                }
            }
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
        function showAddProductModal() {
            if (!appState.user || appState.user.role !== 'seller') {
                showMessage('error', 'Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† ÙÙ‚Ø·');
                return;
            }
            showMessage('info', 'Ø®Ø§ØµÙŠØ© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        function showDepositModal() {
            if (!appState.user) {
                showModal('loginModal');
                return;
            }
            showModal('depositModal');
        }

        function showWithdrawModal() {
            if (!appState.user) {
                showModal('loginModal');
                return;
            }
            showMessage('info', 'Ø®Ø§ØµÙŠØ© Ø§Ù„Ø³Ø­Ø¨ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        async function processDeposit() {
            const amount = document.getElementById('depositAmount').value;
            const method = document.getElementById('depositMethod').value;
            
            if (!amount || amount < 10) {
                showMessage('error', 'Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø±ÙŠØ§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            
            try {
                showLoadingMessage('depositModal', 'Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨ Ø§Ù„Ø´Ø­Ù†...');
                
                const response = await fetch('/api/wallet/topup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        amount: parseFloat(amount), 
                        method: 'manual',
                        wallet_type: method 
                    }),
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                hideLoadingMessage('depositModal');
                
                if (response.ok) {
                    closeModal('depositModal');
                    showMessage('success', 'ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø§Ù„Ø´Ø­Ù† Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­ÙˆÙŠÙ„.');
                    loadWallet();
                } else {
                    showMessage('error', data.error || 'Ø®Ø·Ø£ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø­Ù†');
                }
            } catch (error) {
                hideLoadingMessage('depositModal');
                showMessage('error', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø­Ù†:', error);
            }
        }

        // ============ ØªÙ‡ÙŠØ¦Ø© Ù†Ù‡Ø§Ø¦ÙŠØ© ============
        console.log('ğŸ¯ ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Øª Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„!');
        console.log('ğŸ‘‰ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
    </script>
</body>
</html>
