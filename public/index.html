<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Øª - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„ØªÙˆØµÙŠÙ„</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f5f5f5; color: #333; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 15px; }
        
        /* Header */
        header { 
            background: linear-gradient(135deg, #2E7D32, #1B5E20); 
            color: white; padding: 1rem 0; 
            position: fixed; width: 100%; top: 0; z-index: 1000;
        }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; display: flex; align-items: center; gap: 10px; }
        .nav-menu { display: flex; list-style: none; gap: 1rem; }
        .nav-menu a { color: white; text-decoration: none; padding: 0.5rem 1rem; border-radius: 4px; }
        .nav-menu a:hover { background: rgba(255,255,255,0.1); }
        .user-menu { display: flex; align-items: center; gap: 1rem; }
        
        /* Main Content */
        .main-content { margin-top: 80px; padding: 2rem 0; min-height: calc(100vh - 120px); }
        .card { background: white; border-radius: 10px; padding: 1.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 1.5rem; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #4CAF50; }
        
        /* Products Grid */
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .product-card { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: all 0.3s; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .product-image { height: 200px; background: #e0e0e0; background-size: cover; background-position: center; }
        .product-info { padding: 1.5rem; }
        .product-price { font-size: 1.3rem; font-weight: bold; color: #2E7D32; margin: 0.5rem 0; }
        
        /* Buttons */
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
        .btn-primary { background: #2E7D32; color: white; }
        .btn-primary:hover { background: #1B5E20; }
        .btn-outline { background: transparent; border: 2px solid #2E7D32; color: #2E7D32; }
        .btn-outline:hover { background: #2E7D32; color: white; }
        
        /* Forms */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: white; border-radius: 10px; width: 90%; max-width: 500px; padding: 2rem; }
        .form-group { margin-bottom: 1rem; }
        .form-control { width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 1rem; }
            .nav-menu { flex-wrap: wrap; justify-content: center; }
            .products-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-leaf"></i>
                    <span>ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Øª</span>
                </div>
                
                <ul class="nav-menu" id="mainMenu">
                    <li><a href="#" onclick="showSection('home')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                    <li><a href="#" onclick="showSection('products')">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a></li>
                    <li><a href="#" onclick="showSection('markets')">Ø§Ù„Ø£Ø³ÙˆØ§Ù‚</a></li>
                    <li><a href="#" onclick="showSection('wallet')">Ø§Ù„Ù…Ø­ÙØ¸Ø©</a></li>
                </ul>
                
                <div class="user-menu" id="userMenu">
                    <button class="btn btn-outline" onclick="showLoginModal()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Home Section -->
            <section id="homeSection">
                <div class="card">
                    <div class="card-header">
                        <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Øª</h2>
                        <div id="userGreeting"></div>
                    </div>
                    <p>Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¨ÙŠØ¹ ÙˆØªÙˆØµÙŠÙ„ Ø§Ù„Ù‚Ø§Øª</p>
                    <div class="stats-grid" id="statsGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                        <div class="stat-card" style="background: #E8F5E9; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; color: #2E7D32;">ğŸŒ¿</div>
                            <div>Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù‚Ø§Øª</div>
                        </div>
                        <div class="stat-card" style="background: #E3F2FD; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; color: #1976D2;">ğŸšš</div>
                            <div>ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹</div>
                        </div>
                        <div class="stat-card" style="background: #FFF3E0; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; color: #F57C00;">ğŸ’°</div>
                            <div>Ø¯ÙØ¹ Ø¢Ù…Ù†</div>
                        </div>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ -->
                <div class="card">
                    <div class="card-header">
                        <h3>Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„Ù…ØªØ§Ø­Ø©</h3>
                    </div>
                    <div id="marketsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">
                        <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ù‡Ù†Ø§ -->
                    </div>
                </div>
            </section>

            <!-- Products Section -->
            <section id="productsSection" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù‚Ø§Øª</h2>
                        <button class="btn btn-primary" onclick="loadProducts()">
                            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                        </button>
                    </div>
                    <div class="products-grid" id="productsGrid">
                        <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                </div>
            </section>

            <!-- Markets Section -->
            <section id="marketsSection" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>Ø§Ù„Ø£Ø³ÙˆØ§Ù‚</h2>
                    </div>
                    <div id="marketsList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
                        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ -->
                    </div>
                </div>
            </section>

            <!-- Wallet Section -->
            <section id="walletSection" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>Ù…Ø­ÙØ¸ØªÙƒ</h2>
                        <button class="btn btn-primary" onclick="loadWallet()">
                            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯
                        </button>
                    </div>
                    <div id="walletInfo" style="text-align: center; padding: 2rem;">
                        <div style="font-size: 3rem; color: #2E7D32;">ğŸ’°</div>
                        <h3 id="balanceAmount" style="margin: 1rem 0;">0 Ø±ÙŠØ§Ù„</h3>
                        <p>Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                        <div style="margin-top: 2rem;">
                            <button class="btn btn-primary" onclick="showDepositModal()">
                                <i class="fas fa-money-bill-wave"></i> Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h2 style="text-align: center; margin-bottom: 1.5rem; color: #2E7D32;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <form id="loginForm">
                <div class="form-group">
                    <input type="email" class="form-control" id="loginEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
                </div>
                <div class="form-group">
                    <input type="password" class="form-control" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </form>
            <div style="text-align: center; margin-top: 1rem;">
                <a href="#" onclick="showRegisterModal()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
            </div>
        </div>
    </div>

    <!-- Deposit Modal -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <h2 style="text-align: center; margin-bottom: 1.5rem; color: #2E7D32;">Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯</h2>
            <div class="form-group">
                <label>Ø§Ù„Ù…Ø¨Ù„Øº (Ø±ÙŠØ§Ù„)</label>
                <input type="number" class="form-control" id="depositAmount" min="10" value="100">
            </div>
            <div class="form-group">
                <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                <select class="form-control" id="depositMethod">
                    <option value="jib">Ù…Ø­ÙØ¸Ø© Ø¬ÙŠØ¨</option>
                    <option value="jawaly">Ù…Ø­ÙØ¸Ø© Ø¬ÙˆØ§Ù„ÙŠ</option>
                    <option value="mobile">Ù…ÙˆØ¨Ø§ÙŠÙ„ Ù…ÙˆÙ†ÙŠ</option>
                    <option value="shamel">Ø§Ù„Ø´Ø§Ù…Ù„ Ù…ÙˆÙ†ÙŠ</option>
                    <option value="fulus">ÙÙ„ÙˆØ³Ùƒ</option>
                </select>
            </div>
            <div style="background: #FFF3E0; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                <p><strong>ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù†:</strong></p>
                <p>1. Ø£Ø±Ø³Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¥Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…: <strong>771831482</strong></p>
                <p>2. Ø§Ù„Ø§Ø³Ù…: <strong>ÙŠÙˆØ³Ù Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø­Ù…ÙˆØ¯ Ø²Ù‡ÙŠØ±</strong></p>
                <p>3. Ø£Ø±Ø³Ù„ Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</p>
            </div>
            <div style="display: flex; gap: 1rem;">
                <button class="btn btn-primary" style="flex: 1;" onclick="processDeposit()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</button>
                <button class="btn btn-outline" style="flex: 1;" onclick="closeModal('depositModal')">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let appState = {
            user: null,
            token: null,
            products: [],
            markets: [],
            wallet: null
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadMarkets();
            loadProducts();
            setupEventListeners();
        });

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            document.getElementById('loginForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await login();
            });
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        async function checkAuth() {
            try {
                const response = await fetch('/api/auth/check');
                const data = await response.json();
                
                if (data.isAuthenticated && data.user) {
                    appState.user = data.user;
                    updateUI();
                    loadWallet();
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©:', error);
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password }),
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    appState.user = data.user;
                    updateUI();
                    closeModal('loginModal');
                    showMessage('success', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
                    loadWallet();
                    loadProducts();
                } else {
                    showMessage('error', data.error || 'Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                }
            } catch (error) {
                showMessage('error', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
            }
        }

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function updateUI() {
            const userMenu = document.getElementById('userMenu');
            const userGreeting = document.getElementById('userGreeting');
            
            if (appState.user) {
                userMenu.innerHTML = `
                    <div style="background: #4CAF50; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                        ${appState.user.name.charAt(0)}
                    </div>
                    <span>${appState.user.name}</span>
                    <button class="btn btn-outline" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                `;
                
                userGreeting.innerHTML = `<h3 style="color: #2E7D32;">Ù…Ø±Ø­Ø¨Ø§Ù‹ ${appState.user.name}</h3>`;
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        async function logout() {
            try {
                await fetch('/api/logout', { method: 'POST', credentials: 'include' });
                appState.user = null;
                location.reload();
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:', error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        async function loadProducts() {
            try {
                const response = await fetch('/api/products');
                const data = await response.json();
                
                if (data.success) {
                    appState.products = data.products;
                    renderProducts();
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', error);
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            
            if (!appState.products || appState.products.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #666;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ›’</div>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                        <p>Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = '';
            
            appState.products.forEach(product => {
                const card = `
                    <div class="product-card">
                        <div class="product-image" style="background-image: url('${product.image || 'https://via.placeholder.com/300x200/4CAF50/FFFFFF?text=Qat+Product'}')"></div>
                        <div class="product-info">
                            <h3>${product.name}</h3>
                            <p style="color: #666; margin: 0.5rem 0;">${product.description || 'Ù…Ù†ØªØ¬ Ù‚Ø§Øª Ù…Ù…ØªØ§Ø²'}</p>
                            <div class="product-price">${product.price} Ø±ÙŠØ§Ù„</div>
                            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                <button class="btn btn-outline" onclick="viewProduct(${product.id})">
                                    <i class="fas fa-eye"></i> ØªÙØ§ØµÙŠÙ„
                                </button>
                                ${appState.user ? `
                                    <button class="btn btn-primary" onclick="addToCart(${product.id})">
                                        <i class="fas fa-cart-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
                grid.innerHTML += card;
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚
        async function loadMarkets() {
            try {
                const response = await fetch('/api/markets');
                const data = await response.json();
                
                if (data.success) {
                    appState.markets = data.markets;
                    renderMarkets();
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚:', error);
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚
        function renderMarkets() {
            const container = document.getElementById('marketsContainer');
            const list = document.getElementById('marketsList');
            
            if (!appState.markets || appState.markets.length === 0) {
                const emptyMsg = `
                    <div style="text-align: center; padding: 2rem; color: #666; grid-column: 1/-1;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸª</div>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³ÙˆØ§Ù‚ Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                        <p>Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
                    </div>
                `;
                if (container) container.innerHTML = emptyMsg;
                if (list) list.innerHTML = emptyMsg;
                return;
            }
            
            let marketsHTML = '';
            
            appState.markets.forEach(market => {
                marketsHTML += `
                    <div style="background: white; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                        <h3 style="color: #2E7D32; margin-bottom: 0.5rem;">${market.name}</h3>
                        <p style="color: #666; margin-bottom: 0.5rem;">
                            <i class="fas fa-map-marker-alt"></i> ${market.location || 'Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³ÙˆÙ‚'}
                        </p>
                        <p style="color: #666; margin-bottom: 1rem;">
                            <i class="fas fa-phone"></i> ${market.phone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù…'}
                        </p>
                        <p style="font-size: 0.9rem; color: #888;">${market.description || 'Ø³ÙˆÙ‚ Ù„Ø¨ÙŠØ¹ Ø§Ù„Ù‚Ø§Øª'}</p>
                    </div>
                `;
            });
            
            if (container) container.innerHTML = marketsHTML;
            if (list) list.innerHTML = marketsHTML;
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ÙØ¸Ø©
        async function loadWallet() {
            if (!appState.user) return;
            
            try {
                const response = await fetch('/api/wallet', {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (data.success) {
                    appState.wallet = data.wallet;
                    updateWalletDisplay();
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ÙØ¸Ø©:', error);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ÙØ¸Ø©
        function updateWalletDisplay() {
            const balanceAmount = document.getElementById('balanceAmount');
            if (balanceAmount && appState.wallet) {
                balanceAmount.textContent = `${appState.wallet.balance} Ø±ÙŠØ§Ù„`;
            }
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        function showSection(sectionId) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            const sections = ['homeSection', 'productsSection', 'marketsSection', 'walletSection'];
            sections.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.style.display = 'none';
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù…
                if (sectionId === 'productsSection') {
                    loadProducts();
                } else if (sectionId === 'marketsSection') {
                    loadMarkets();
                } else if (sectionId === 'walletSection' && appState.user) {
                    loadWallet();
                }
            }
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†ÙˆØ§ÙØ°
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
        }

        function showRegisterModal() {
            alert('Ø®Ø§ØµÙŠØ© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ØªØ§Ø­Ø© Ø¹Ø¨Ø± API. Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ø§Ø© Ù…Ø«Ù„ Postman Ù„Ù„ØªØ¬Ø±Ø¨Ø©.');
        }

        function showDepositModal() {
            if (!appState.user) {
                showLoginModal();
                return;
            }
            document.getElementById('depositModal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø´Ø­Ù†
        async function processDeposit() {
            const amount = document.getElementById('depositAmount').value;
            const method = document.getElementById('depositMethod').value;
            
            if (!amount || amount < 10) {
                showMessage('error', 'Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø±ÙŠØ§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            
            try {
                const response = await fetch('/api/wallet/topup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        amount: parseFloat(amount), 
                        method: 'manual',
                        wallet_type: method 
                    }),
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    closeModal('depositModal');
                    showMessage('success', 'ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø§Ù„Ø´Ø­Ù† Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­ÙˆÙŠÙ„.');
                    loadWallet();
                } else {
                    showMessage('error', data.error || 'Ø®Ø·Ø£ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø­Ù†');
                }
            } catch (error) {
                showMessage('error', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
            }
        }

        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        function showMessage(type, text) {
            alert((type === 'success' ? 'âœ… ' : 'âŒ ') + text);
        }

        function viewProduct(productId) {
            alert(`Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ ${productId} - Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±`);
        }

        function addToCart(productId) {
            if (!appState.user) {
                showLoginModal();
                return;
            }
            alert(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ ${productId} Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© - Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±`);
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        };
    </script>
</body>
</html>
